{
  "meta": {
    "timestamp": "2026-02-10T09:00:00+05:00",
    "commit": "37734a7",
    "branch": "work",
    "nodeVersion": "v24.12.0",
    "scope": "supporting-layers",
    "layers": ["config", "infrastructure", "integrations", "shared", "socket", "utils"]
  },
  "scores": {
    "performance": 26,
    "architecture": 18,
    "realtime": 14,
    "codeQuality": 12,
    "security": 9,
    "readability": 8,
    "total": 87
  },
  "findings": [
    {
      "id": "SL-001",
      "severity": "MEDIUM",
      "dimension": "Security & Reliability",
      "file": "src/infrastructure/health.ts",
      "function": "createHealthRoutes",
      "problem": "Health endpoint exposes internal details (Redis status, worker count, build info) without authentication",
      "evidence": "fastify.get(\"/health\", async ...) — no auth middleware",
      "impact": "Information disclosure to unauthenticated attackers",
      "repro": "curl https://server/health",
      "fix": "Split into /health (simple 200/503) and /health/detailed (authenticated)",
      "complexity": "0.5h",
      "docsPath": "docs/Architecture/README.md"
    },
    {
      "id": "SL-002",
      "severity": "MEDIUM",
      "dimension": "Performance & Efficiency",
      "file": "src/infrastructure/redis.ts",
      "function": "getRedisClient",
      "problem": "Redis singleton has no graceful shutdown/disconnect method",
      "evidence": "let redisInstance: Redis | null = null; — no disconnect export",
      "impact": "Redis connection hangs during shutdown or tests",
      "repro": "Process hangs on exit when Redis client is still open",
      "fix": "Export disconnectRedis() function",
      "complexity": "0.5h",
      "docsPath": "docs/Architecture/README.md"
    },
    {
      "id": "SL-003",
      "severity": "MEDIUM",
      "dimension": "Realtime Correctness",
      "file": "src/integrations/laravel/event-subscriber.ts",
      "function": "LaravelEventSubscriber.parseEvent",
      "problem": "JSON.parse not wrapped in try/catch within parseEvent",
      "evidence": "const parsed = JSON.parse(message); — throws on malformed JSON",
      "impact": "Error propagates with generic message instead of specific parse error",
      "repro": "Publish malformed JSON to flylive:msab:events channel",
      "fix": "Wrap JSON.parse in try/catch and return null with specific warning",
      "complexity": "0.25h",
      "docsPath": null
    },
    {
      "id": "SL-004",
      "severity": "MEDIUM",
      "dimension": "Performance & Efficiency",
      "file": "src/integrations/laravel/event-router.ts",
      "function": "EventRouter.emitToUser",
      "problem": "Sequential socket emission in loop instead of batch",
      "evidence": "for (const socketId of socketIds) { this.io.to(socketId).emit(event, payload); }",
      "impact": "N Redis adapter calls instead of 1 for multi-socket users",
      "repro": "User with multiple tabs generates multiple adapter calls",
      "fix": "Chain .to() calls and emit once",
      "complexity": "0.25h",
      "docsPath": null
    },
    {
      "id": "SL-005",
      "severity": "MEDIUM",
      "dimension": "Architecture & Scalability",
      "file": "src/socket/index.ts",
      "function": "initializeSocket",
      "problem": "Monolithic 198-line bootstrap function handles all initialization and disconnect logic",
      "evidence": "Single function creates 10+ services, wires them, handles connection and disconnect",
      "impact": "Hard to test individual components; couples disconnect to socket setup",
      "repro": "N/A — structural concern",
      "fix": "Extract disconnect handler and service wiring into separate modules",
      "complexity": "2h",
      "docsPath": null
    },
    {
      "id": "SL-006",
      "severity": "MEDIUM",
      "dimension": "Code Quality",
      "file": "src/utils/crypto.ts",
      "function": "hashToken + generateCorrelationId",
      "problem": "Crypto utilities split across utils/crypto.ts and shared/correlation.ts",
      "evidence": "Both use node:crypto but are in different directories",
      "impact": "Confusing DX — developers must check two locations",
      "fix": "Consolidate into single crypto utility module",
      "complexity": "0.25h",
      "docsPath": null
    },
    {
      "id": "SL-007",
      "severity": "MEDIUM",
      "dimension": "Code Quality",
      "file": "src/integrations/laravel/user-socket.repository.ts",
      "function": "UserSocketRepository",
      "problem": "Logger imported directly instead of constructor injection",
      "evidence": "import { logger } from '../../infrastructure/logger.js'; — not injected",
      "impact": "Inconsistent DI pattern; harder to test with mock logger",
      "fix": "Accept logger as constructor parameter",
      "complexity": "0.25h",
      "docsPath": null
    },
    {
      "id": "SL-008",
      "severity": "LOW",
      "dimension": "Readability",
      "file": "src/socket/index.ts",
      "function": "initializeSocket (onAny)",
      "problem": "Debug-mode onAny listener with hardcoded event names in production path",
      "evidence": "socket.onAny with seat:lock and seat:invite filter",
      "impact": "Runs for every event on every socket in production",
      "fix": "Gate behind isDev check or remove",
      "complexity": "0.1h",
      "docsPath": null
    },
    {
      "id": "SL-009",
      "severity": "LOW",
      "dimension": "Performance & Efficiency",
      "file": "src/infrastructure/worker.manager.ts",
      "function": "WorkerManager.getLeastLoadedWorker",
      "problem": "cpuUsage collected but never used in worker selection",
      "evidence": "Selection only uses routerCount; cpuUsage gathered every 10s but ignored",
      "impact": "Wasted async calls to getResourceUsage()",
      "fix": "Either use cpuUsage in scoring or remove the collection",
      "complexity": "0.5h",
      "docsPath": null
    },
    {
      "id": "SL-010",
      "severity": "LOW",
      "dimension": "Architecture & Scalability",
      "file": "src/socket/schemas.ts",
      "function": "N/A",
      "problem": "All domain Zod schemas centralized instead of co-located with domains",
      "evidence": "258-line file with Gift, Seat, Chat, Room, Media schemas",
      "impact": "Cross-domain coupling; breaks domain-based architecture pattern",
      "fix": "Move domain schemas to domains/<domain>/schemas.ts",
      "complexity": "1.5h",
      "docsPath": null
    },
    {
      "id": "SL-011",
      "severity": "LOW",
      "dimension": "Security & Reliability",
      "file": "src/infrastructure/metrics.ts",
      "function": "createMetricsRoutes",
      "problem": "Metrics endpoints unauthenticated",
      "evidence": "fastify.get(\"/metrics/prometheus\", ...) — no auth",
      "impact": "System metrics exposed publicly",
      "fix": "Add bearer token check or IP allowlist",
      "complexity": "0.5h",
      "docsPath": null
    },
    {
      "id": "SL-012",
      "severity": "LOW",
      "dimension": "Realtime Correctness",
      "file": "src/socket/index.ts",
      "function": "disconnect handler",
      "problem": "Sequential await calls in disconnect handler",
      "evidence": "Multiple sequential awaits for seat leave, socket unregister, room clear",
      "impact": "Slow disconnect cleanup under high concurrency",
      "fix": "Use Promise.allSettled for independent operations",
      "complexity": "0.5h",
      "docsPath": null
    },
    {
      "id": "SL-013",
      "severity": "LOW",
      "dimension": "Code Quality",
      "file": "src/config/index.ts",
      "function": "configSchema",
      "problem": "Boolean env var transform pattern duplicated for REDIS_TLS and MSAB_EVENTS_ENABLED",
      "evidence": "Same .transform((v) => v === 'true' || v === '1') in two places",
      "impact": "Minor DRY violation",
      "fix": "Extract booleanEnvSchema helper",
      "complexity": "0.1h",
      "docsPath": null
    },
    {
      "id": "SL-014",
      "severity": "INFO",
      "dimension": "Architecture & Scalability",
      "file": "src/context.ts",
      "function": "AppContext",
      "problem": "AppContext is a god object with 12 dependencies",
      "evidence": "Interface with io, redis, workerManager, roomManager, and 8 more",
      "impact": "Any handler can access any service; no dependency boundaries",
      "fix": "Consider domain-specific context slices",
      "complexity": "3h",
      "docsPath": null
    }
  ],
  "overEngineering": []
}
