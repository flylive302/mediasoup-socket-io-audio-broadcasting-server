{
  "meta": {
    "timestamp": "2026-02-13T09:18:00+05:00",
    "commit": "28ec11d",
    "branch": "work",
    "nodeVersion": ">=22.0.0",
    "scope": "relay-domain",
    "filesAnalyzed": 5,
    "totalLines": 830
  },
  "scores": {
    "performance": 7.5,
    "architecture": 8.0,
    "realtime": 7.0,
    "codeQuality": 6.0,
    "security": 7.5,
    "readability": 8.0,
    "total": 73.5
  },
  "findings": [
    {
      "id": "RL-001",
      "severity": "HIGH",
      "dimension": "Realtime Correctness",
      "file": "src/integrations/laravel/event-subscriber.ts",
      "function": "message handler",
      "problem": "Backpressure threshold check runs AFTER inFlightCount is decremented",
      "evidence": "finally { this.inFlightCount--; if (this.inFlightCount > BACKPRESSURE_THRESHOLD) }",
      "impact": "Backpressure is detected 1 event late and never fires at threshold+1",
      "repro": "Send BACKPRESSURE_THRESHOLD+1 concurrent events; observe no warning log",
      "fix": "Move backpressure check to after increment (entry point), before the try block",
      "complexity": "0.5h",
      "docsPath": "docs/Events/Relay/README.md"
    },
    {
      "id": "RL-002",
      "severity": "MEDIUM",
      "dimension": "Code Quality",
      "file": "src/integrations/laravel/user-socket.repository.ts",
      "function": "hasActiveSockets, getSocketCount, clearUser",
      "problem": "3 methods defined but never called anywhere in the codebase",
      "evidence": "rg 'hasActiveSockets|getSocketCount|clearUser[^R]' src/ — only definition hits",
      "impact": "Dead code increases maintenance burden",
      "repro": "rg -c 'hasActiveSockets|getSocketCount|clearUser[^R]' src/ --type ts",
      "fix": "Remove all 3 methods (~30 lines)",
      "complexity": "0.5h",
      "docsPath": null
    },
    {
      "id": "RL-003",
      "severity": "MEDIUM",
      "dimension": "Performance & Efficiency",
      "file": "src/integrations/laravel/user-socket.repository.ts",
      "function": "unregisterSocket",
      "problem": "Inline Lua script string re-created on every call",
      "evidence": "const UNREGISTER_LUA = `redis.call('srem'...)` inside method body",
      "impact": "Unnecessary string allocation per disconnect; GC pressure at scale",
      "repro": "Profile heap during mass disconnect — observe repeated string allocations",
      "fix": "Hoist UNREGISTER_LUA to module-level const",
      "complexity": "0.5h",
      "docsPath": null
    },
    {
      "id": "RL-004",
      "severity": "MEDIUM",
      "dimension": "Performance & Efficiency",
      "file": "src/integrations/laravel/event-subscriber.ts",
      "function": "message handler",
      "problem": "Processing duration histogram only measures sync parse, not async routing",
      "evidence": "Duration measured before async fire-and-forget onEvent call completes",
      "impact": "flylive_laravel_event_processing_duration_seconds is misleadingly low",
      "repro": "Check Prometheus metric — values will be ~0.01ms regardless of routing time",
      "fix": "Measure duration inside EventRouter.route() or pass startTime through callback",
      "complexity": "1h",
      "docsPath": "docs/Events/Relay/README.md"
    },
    {
      "id": "RL-005",
      "severity": "LOW",
      "dimension": "Code Quality",
      "file": "src/integrations/laravel/types.ts",
      "function": "KNOWN_EVENTS, KnownEventType",
      "problem": "Exported but never imported by any consumer",
      "evidence": "rg 'KNOWN_EVENTS|KnownEventType' src/ — only types.ts and index.ts barrel",
      "impact": "Confusing API surface — consumers don't know which export to use",
      "repro": "rg -c 'import.*KNOWN_EVENTS' src/",
      "fix": "Deprecate with @deprecated JSDoc, remove after confirming no external consumers",
      "complexity": "0.5h",
      "docsPath": "docs/Events/Relay/README.md"
    },
    {
      "id": "RL-006",
      "severity": "LOW",
      "dimension": "Realtime Correctness",
      "file": "src/integrations/laravel/event-subscriber.ts",
      "function": "messageBuffer handler",
      "problem": "Logs but drops events received as Buffer — silent data loss",
      "evidence": "this.subscriber.on('messageBuffer', ... => { this.logger.debug('buffer mode') })",
      "impact": "If ioredis sends messageBuffer, events are lost without alerting",
      "repro": "Force ioredis Buffer mode and publish an event",
      "fix": "Either parse Buffer→string and route, or remove handler and document limitation",
      "complexity": "0.5h",
      "docsPath": "docs/Events/Relay/README.md"
    },
    {
      "id": "RL-007",
      "severity": "LOW",
      "dimension": "Code Quality",
      "file": "src/integrations/laravel/event-router.ts",
      "function": "route",
      "problem": "Optional chaining (?.) on metric that is always defined",
      "evidence": "metrics.laravelEventsReceived?.inc() vs metrics.laravelEventsInFlight.inc()",
      "impact": "Inconsistency signals uncertainty about metric initialization",
      "repro": "Visual inspection of metrics calls",
      "fix": "Remove ?. — use direct .inc()",
      "complexity": "0.25h",
      "docsPath": null
    },
    {
      "id": "RL-008",
      "severity": "INFO",
      "dimension": "Code Quality",
      "file": "tests/unit/ (missing)",
      "function": "EventRouter, LaravelEventSubscriber, UserSocketRepository",
      "problem": "Zero unit test coverage for all relay domain classes",
      "evidence": "fd 'laravel|relay|event-router' tests/ — 0 results",
      "impact": "High regression risk; RL-001 would have been caught by tests",
      "repro": "npm run test -- --coverage",
      "fix": "Create tests: EventRouter (4 routing modes), parseEvent (malformed), UserSocketRepository (CRUD)",
      "complexity": "3h",
      "docsPath": null
    },
    {
      "id": "RL-009",
      "severity": "INFO",
      "dimension": "Security & Reliability",
      "file": "src/integrations/laravel/event-subscriber.ts",
      "function": "parseEvent",
      "problem": "No validation of event name against known event types",
      "evidence": "Only checks typeof obj.event !== 'string' — any string passes",
      "impact": "Typos or rogue events from Laravel silently relayed to frontend",
      "repro": "Publish {event:'test.unknown',...} to Redis channel",
      "fix": "Log unknown events at warn level (don't block — preserve pass-through)",
      "complexity": "1h",
      "docsPath": "docs/Events/Relay/README.md"
    },
    {
      "id": "RL-010",
      "severity": "INFO",
      "dimension": "Performance & Efficiency",
      "file": "src/integrations/laravel/event-router.ts",
      "function": "route (metrics)",
      "problem": "Unbounded event_type label cardinality in Prometheus metrics",
      "evidence": "metrics.laravelEventsReceived?.inc({ event_type: event.event }) — unvalidated",
      "impact": "Prometheus cardinality explosion if rogue events arrive",
      "repro": "Publish events with random names; observe prom-client memory growing",
      "fix": "Validate against known events or bucket unknown under 'unknown' label",
      "complexity": "0.5h",
      "docsPath": null
    }
  ],
  "overEngineering": []
}
