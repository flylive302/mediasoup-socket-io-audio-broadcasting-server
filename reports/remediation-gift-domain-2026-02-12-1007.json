{
  "meta": {
    "timestamp": "2026-02-12T10:07:00+05:00",
    "auditRef": "reports/audit-gift-domain-2026-02-12-0955.json",
    "commit": "407ed04"
  },
  "remediations": [
    {
      "issueId": "GF-012",
      "severity": "MEDIUM",
      "filesTouched": [
        "src/shared/errors.ts",
        "src/domains/gift/giftHandler.ts",
        "tests/unit/domains/gift/giftHandler.test.ts"
      ],
      "patchSketch": "Added CANNOT_GIFT_SELF error constant; added if (user.id === payload.recipientId) guard in gift:send handler",
      "downstreamCallsites": [],
      "runtimeRisk": "Minimal — one integer comparison added before existing flow",
      "rollback": "Remove guard from giftHandler.ts and error constant from errors.ts",
      "hours": 0.25,
      "owner": "AI",
      "priority": "P1",
      "docsUpdates": [],
      "testsRequired": [
        "tests/unit/domains/gift/giftHandler.test.ts — rejects gift:send when sender === recipient (GF-012)"
      ]
    },
    {
      "issueId": "GF-013",
      "severity": "MEDIUM",
      "filesTouched": [
        "src/socket/schemas.ts",
        "tests/unit/domains/gift/giftHandler.test.ts"
      ],
      "patchSketch": "Added .max(9999) to sendGiftSchema quantity field",
      "downstreamCallsites": [],
      "runtimeRisk": "Clients sending quantity > 9999 will receive validation errors",
      "rollback": "Remove .max(9999) from schemas.ts",
      "hours": 0.1,
      "owner": "AI",
      "priority": "P1",
      "docsUpdates": [],
      "testsRequired": [
        "tests/unit/domains/gift/giftHandler.test.ts — rejects gift:send when quantity exceeds 9999 (GF-013)"
      ]
    },
    {
      "issueId": "GF-014",
      "severity": "LOW",
      "filesTouched": [
        "src/domains/gift/giftBuffer.ts",
        "tests/unit/domains/gift/giftBuffer.test.ts"
      ],
      "patchSketch": "Added flushCount counter; wrapped DLQ llen() in if (flushCount % 10 === 0) condition",
      "downstreamCallsites": [
        "Prometheus /metrics endpoint — DLQ metric updates ~10x less frequently"
      ],
      "runtimeRisk": "DLQ metric may lag by up to 5 seconds. Acceptable for alerting.",
      "rollback": "Remove flushCount field and modulo condition",
      "hours": 0.5,
      "owner": "AI",
      "priority": "P2",
      "docsUpdates": [],
      "testsRequired": [
        "tests/unit/domains/gift/giftBuffer.test.ts — reports dead-letter queue size metric on 10th flush (GF-006, GF-014)"
      ]
    },
    {
      "issueId": "GF-015",
      "severity": "LOW",
      "filesTouched": [
        "src/socket/index.ts"
      ],
      "patchSketch": "Expanded architecture documentation comment explaining GiftHandler lifecycle registration pattern",
      "downstreamCallsites": [],
      "runtimeRisk": "None — documentation only",
      "rollback": "Revert comment",
      "hours": 0.1,
      "owner": "AI",
      "priority": "P3",
      "docsUpdates": [],
      "testsRequired": []
    },
    {
      "issueId": "GF-016",
      "severity": "INFO",
      "filesTouched": [
        "src/domains/gift/giftHandler.ts"
      ],
      "patchSketch": "Replaced .catch(() => {}) with .catch((err) => logger.debug({ err, roomId }, 'auto-close activity recording failed'))",
      "downstreamCallsites": [],
      "runtimeRisk": "None — changes error handling from silent to debug-logged",
      "rollback": "Revert to empty catch",
      "hours": 0.1,
      "owner": "AI",
      "priority": "P3",
      "docsUpdates": [],
      "testsRequired": []
    }
  ],
  "prPlan": [
    {
      "prNumber": 1,
      "title": "fix(gift): input validation hardening (GF-012, GF-013)",
      "files": [
        "src/shared/errors.ts",
        "src/socket/schemas.ts",
        "src/domains/gift/giftHandler.ts",
        "tests/unit/domains/gift/giftHandler.test.ts"
      ],
      "dependsOn": []
    },
    {
      "prNumber": 2,
      "title": "fix(gift): reliability, observability & architecture docs (GF-014, GF-015, GF-016)",
      "files": [
        "src/domains/gift/giftBuffer.ts",
        "src/domains/gift/giftHandler.ts",
        "src/socket/index.ts",
        "tests/unit/domains/gift/giftBuffer.test.ts"
      ],
      "dependsOn": []
    }
  ],
  "sprintPlan": [
    {
      "sprint": 1,
      "focus": "Gift domain remediation (all findings)",
      "prs": [1, 2],
      "hours": 1.05
    }
  ]
}
